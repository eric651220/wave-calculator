<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ê≥¢Êµ™Ë®àÁÆóÂô® V74.6</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <script src="script.js" defer></script>
</head>
<body>
    <div class="app-window">
        <div class="header">
            <div class="header-title">Ê≥¢Êµ™Ë®àÁÆóÂô® V74.6</div>
            <div class="header-controls">
                <div class="cap-wrapper">
                    <div class="cap-input-box">
                        <span class="cap-symbol">$</span>
                        <input type="number" id="totalCap" placeholder="Èå¢ÂåÖ" value="1000000" oninput="updateEst()">
                    </div>
                </div>
                <button class="hamburger-btn" onclick="toggleMenu()">‚ò∞</button>
            </div>
        </div>
        
        <div id="view-container">
            <div id="tab-home" class="workspace active">
                <div class="panel-left">
                    <div class="unified-grid">
                        <div class="input-group area-p0">
                            <div class="fine-tune-box">
                                <span class="input-prefix">P0</span>
                                <input type="number" id="vRefA" placeholder="Ëº∏ÂÖ•" oninput="checkInitState()">
                            </div>
                        </div>
                        <div class="input-group area-p1">
                            <div class="fine-tune-box">
                                <span class="input-prefix">P1</span>
                                <input type="number" id="vRefB" placeholder="Ëº∏ÂÖ•" oninput="checkInitState()">
                            </div>
                        </div>
                        <div class="input-group area-next">
                            <div class="fine-tune-box" id="box-next">
                                <button class="ft-btn" onclick="adjustVal('vNext', -10)">‚àí</button>
                                <span class="input-prefix prefix-blue" style="margin-left:4px;">Next</span>
                                <input type="number" id="vNext" placeholder="ÁõÆÊ®ôÂÉπ" oninput="onNextInput()" disabled>
                                <button class="ft-btn" onclick="adjustVal('vNext', 10)">+</button>
                            </div>
                        </div>
                        <div class="input-group area-trade">
                            <div class="trade-module" id="tradeModule">
                                <div class="tm-toggle is-buy" id="tradeToggle" onclick="toggleTradeMode()">Ë≤∑</div>
                                <div class="tm-input">
                                    <span class="input-prefix prefix-gold">ËÇ°Êï∏</span>
                                    <input type="number" id="vAmt" placeholder="Shares" oninput="updateEst()">
                                </div>
                            </div>
                            <div id="estAmount" class="est-amount"></div>
                        </div>
                    </div>
                    
                    <div class="dashboard-area">
                        <div class="info-row">
                            <div class="info-card">
                                <div class="ic-label">ÊåÅÂÄâ Shares</div>
                                <div class="ic-val" style="color:var(--color-gold)" id="dispShares">---</div>
                            </div>
                            <div class="info-card">
                                <div class="ic-label">ÂùáÂÉπ Cost</div>
                                <div class="ic-val" id="dispCost">---</div>
                            </div>
                            <div class="info-card">
                                <div class="ic-label">Â∑≤ÂØ¶Áèæ Banked</div>
                                <div class="ic-val" id="dispRealized">---</div>
                            </div>
                            <div class="info-card">
                                <div class="ic-label">ÊµÆÂãï Paper</div>
                                <div class="ic-val" id="dispPL">---</div>
                            </div>
                        </div>
                        
                        <div class="btn-row">
                            <button class="btn-icon danger" onclick="resetAll()" title="ÂÖ®ÈÉ®ÈáçÁΩÆ">‚Ü∫</button>
                            <button class="btn-icon" onclick="shareToLine()" title="Êà™ÂúñÂàÜ‰∫´">üì∑</button>
                            
                            <button class="btn-icon" id="btnUndo"
                                    onmousedown="handleUndoPress()" 
                                    onmouseup="handleUndoRelease()" 
                                    onmouseleave="handleUndoRelease()"
                                    ontouchstart="handleUndoPress(event)" 
                                    ontouchend="handleUndoRelease(event)"
                                    oncontextmenu="event.preventDefault();"
                                    title="‰∏ä‰∏ÄÂãï">
                                ‚Ü∂
                            </button>
                            <div id="historyMenu"></div>

                            <button class="btn-icon save" onclick="openSaveModal()" title="ÂÑ≤Â≠òË°åÊÉÖ">üíæ</button>
                            
                            <button id="btnLock" class="btn-main disabled" onclick="confirmNextWave()">ÂàùÂßãÈéñÂÆö</button>
                        </div>
                    </div>
                </div>
                
                <div class="panel-right">
                    <div id="chart-container">
                        <svg id="waveChart" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="chartGradient" x1="0" x2="0" y1="0" y2="1">
                                    <stop offset="0%" stop-color="var(--chart-grad-start)"/>
                                    <stop offset="100%" stop-color="var(--chart-grad-stop)"/>
                                </linearGradient>
                            </defs>
                            <g id="gridGroup"></g>
                            <g id="zoneGroup"></g>
                            <line id="costLine" class="cost-line" x1="0" y1="0" x2="0" y2="0" style="display:none;" />
                            <text id="costText" class="cost-text" x="0" y="0" style="display:none;"></text>
                            <line id="limitLine" class="limit-line" x1="0" y1="0" x2="0" y2="0" style="display:none;" />
                            <text id="limitText" class="limit-text" x="0" y="0" style="display:none;"></text>
                            <path id="waveArea" class="chart-area" d="" />
                            <path id="wavePath" class="chart-line" d="" />
                            <path id="waveGhost" class="chart-line" style="stroke-dasharray:4 4; opacity:0.5;" d="" />
                            <g id="dotsGroup"></g>
                            <g id="chartOverlayGroup" style="pointer-events:none;"></g>
                            <g id="crosshairGroup" style="display:none;">
                                <line id="crosshairH" class="crosshair-line" x1="0" y1="0" x2="0" y2="0"/>
                                <line id="crosshairV" class="crosshair-line" x1="0" y1="0" x2="0" y2="0"/>
                                <rect id="tooltipBox" class="tooltip-box" rx="4" width="0" height="0" />
                                <text id="tooltipText" class="tooltip-text" x="0" y="0" text-anchor="middle"></text>
                                <text id="tapHint" class="tap-hint" x="0" y="0" text-anchor="end">ÈªûÊìäË®≠ÂÆöÂÉπÊ†º</text>
                            </g>
                        </svg>
                    </div>
                    
                    <div id="header-static">
                        <div class="smart-header" id="smartHeader" style="display:none;">
                            <div style="display:flex; align-items:center;">
                                <button class="chart-toggle-btn" onclick="toggleChartVisibility()">‚óì</button>
                                <div class="sh-title" id="headerTitle"></div>
                            </div>
                            <div style="display:flex; align-items:center;">
                                <button class="filter-toggle active" id="btnFilter" onclick="toggleFilterMode()">‚ö° Âè™ÁúãÂº∑ÂçÄ</button>
                                <button class="sh-toggle" id="headerToggle" onclick="toggleDirection()">ÂàáÊèõ ‚áÑ</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="list-scroll">
                        <div id="list">
                            <div style="text-align:center; margin-top:60px; color:var(--text-sub); font-size:14px; font-weight:700; opacity:0.6;">
                                Ë´ãËº∏ÂÖ• P0 Ëàá P1 ‰ª•ÈñãÂßã
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-ext" class="page-content">
                <div style="padding:16px 20px; font-size:18px; font-weight:700; border-bottom:1px solid var(--border);">Ê≠∑Âè≤Ë°åÊÉÖÁ¥ÄÈåÑ</div>
                
                <div class="backup-controls">
                    <button class="btn-backup" onclick="exportJSON()">
                        <span>üì§</span> ÂåØÂá∫ÂÇô‰ªΩ
                    </button>
                    <button class="btn-backup" onclick="triggerImport()">
                        <span>üì•</span> ÂåØÂÖ•ÈÇÑÂéü
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display:none" onchange="handleImport(this)">
                </div>

                <div id="historyList" class="history-list-container">
                    <div style="text-align:center; margin-top:40px; color:var(--text-sub); width:100%; grid-column: 1/-1;">
                        Â∞öÊú™ÂÑ≤Â≠ò‰ªª‰ΩïË°åÊÉÖ
                    </div>
                </div>
            </div>
        </div>

        <div class="drawer-overlay" id="drawerOverlay" onclick="toggleMenu()"></div>
        <div class="nav-drawer" id="navDrawer">
            <div class="drawer-header">Â∞éËà™ÈÅ∏ÂñÆ</div>
            <div class="drawer-item active" id="menu-home" onclick="switchTab('home')">
                <span>üìä</span> Êà∞ÊÉÖ‰∏ªÊéß
            </div>
            <div class="drawer-item" id="menu-ext" onclick="switchTab('ext')">
                <span>üìÇ</span> Ê≠∑Âè≤Ë°åÊÉÖ
            </div>
            <div class="drawer-divider"></div>
            <div class="drawer-item" onclick="toggleTheme(); toggleMenu()">
                <span>üåì</span> ÂàáÊèõ‰∏ªÈ°å
            </div>
        </div>

        <div class="modal-overlay" id="saveModal">
            <div class="modal-card">
                <div class="modal-title">ÂÑ≤Â≠òË°åÊÉÖ</div>
                <div class="modal-input-group">
                    <span class="modal-label">ËÇ°Ëôü / ÂêçÁ®±</span>
                    <input type="text" id="saveSymbol" class="modal-input" placeholder="‰æãÂ¶Ç: 2330 Âè∞Á©çÈõª">
                </div>
                <div class="modal-input-group">
                    <span class="modal-label">Ëµ∑ÂßãÊó•Êúü</span>
                    <input type="date" id="saveStart" class="modal-input">
                </div>
                <div class="modal-input-group">
                    <span class="modal-label">ÁµÇÈªûÊó•Êúü</span>
                    <input type="date" id="saveEnd" class="modal-input">
                </div>
                <div class="modal-btn-row">
                    <button class="modal-btn btn-cancel" onclick="closeSaveModal()">ÂèñÊ∂à</button>
                    <button class="modal-btn btn-confirm" onclick="saveRecord()">Á¢∫Ë™çÂÑ≤Â≠ò</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('PWA Service Worker Ë®ªÂÜäÊàêÂäü', reg.scope))
                    .catch(err => console.log('PWA Ë®ªÂÜäÂ§±Êïó:', err));
            });
        }
    </script>
</body>
</html>